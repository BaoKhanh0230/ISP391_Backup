<!-- file: resources/templates/admin/room/list.html -->
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Room Management</title>

    <!-- Bootstrap CSS -->
    <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
            rel="stylesheet"
    />
    <!-- Bootstrap Icons -->
    <link
            href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
            rel="stylesheet"
    />

    <style>
        /* ===== CARD GẦN VUÔNG, CÓ BÓNG KHI HOVER ===== */
        .room-card {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background-color: #fff;
            transition: box-shadow 0.2s ease-in-out;
            min-height: 200px; /* chiều cao tối thiểu để card “vuông” hơn */
            display: flex;
            flex-direction: column;
        }
        .room-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        /* ===== NỘI DUNG CHÍNH (click để xem Detail) ===== */
        .room-content {
            cursor: pointer;
        }
        .room-content:hover {
            /* highlight nhẹ nếu cần */
        }

        /* ===== NỘI DUNG TRONG CARD ===== */
        .room-card .card-body {
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            flex: 1; /* để nút toggle status luôn ở đáy */
        }

        .room-info {
            font-size: 0.95rem;
            color: #333;
            line-height: 1.5;
        }
        .room-info p {
            margin-bottom: 0.5rem;
        }

        .room-status {
            font-size: 0.85rem;
            padding: 0.3rem 0.6rem;
            border-radius: 12px;
            white-space: nowrap;
        }

        /* ===== BUTTONS ===== */
        .btn-action {
            font-size: 0.9rem;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            transition: background-color 0.2s ease-in-out;
        }
        .btn-action:hover {
            opacity: 0.9;
        }
        .btn-warning.btn-action {
            background-color: #ffc107;
            border-color: #ffc107;
        }
        .btn-success.btn-action {
            background-color: #28a745;
            border-color: #28a745;
        }

        /* ===== CĂN NÚT ===== */
        .button-container {
            margin-top: 1rem; /* Khoảng cách consistent */
        }
    </style>
</head>
<body>
<div class="container-fluid py-4">
    <!-- Header: Add + Back + Refresh -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="mb-0">Room Management</h2>
        <div>
            <!-- Nút Add Room kích hoạt modal -->
            <button
                    type="button"
                    class="btn btn-success me-2"
                    data-bs-toggle="modal"
                    data-bs-target="#roomModal"
                    data-mode="add"
            >
                <i class="bi bi-plus-lg"></i> Add Room
            </button>

            <a th:href="@{/admin/dashboard(adminId=${adminId})}" class="btn btn-outline-primary me-2">
                <i class="bi bi-house-door-fill"></i> Back to Dashboard
            </a>
            <a th:href="@{/admin/rooms(adminId=${adminId})}" class="btn btn-primary">
                <i class="bi bi-arrow-clockwise"></i> Refresh
            </a>
        </div>
    </div>

    <!-- Search & Filter -->
    <div class="card mb-3">
        <div class="card-body">
            <form th:action="@{/admin/rooms}" method="get" class="row g-2 align-items-end">
                <input type="hidden" name="adminId" th:value="${adminId}" />
                <div class="col-md-4">
                    <label for="search" class="form-label">Search Number / Name</label>
                    <input
                            type="text"
                            id="search"
                            name="search"
                            th:value="${search}"
                            class="form-control"
                            placeholder="Enter keyword…"
                    />
                </div>
                <div class="col-md-3">
                    <label for="statusFilter" class="form-label">Filter by Status</label>
                    <select id="statusFilter" name="statusFilter" class="form-select">
                        <option value="" th:selected="${statusFilter == null}">All</option>
                        <option value="Available" th:selected="${statusFilter == 'Available'}">Available</option>
                        <option value="Occupied" th:selected="${statusFilter == 'Occupied'}">Occupied</option>
                    </select>
                </div>
                <div class="col-auto">
                    <button type="submit" class="btn btn-success">
                        <i class="bi bi-search"></i> Search
                    </button>
                </div>
                <div class="col-auto">
                    <a th:href="@{/admin/rooms(adminId=${adminId})}" class="btn btn-secondary">
                        <i class="bi bi-x-circle"></i> Clear
                    </a>
                </div>
            </form>
        </div>
    </div>

    <!-- ===========================================================
         Dùng Bootstrap Grid với:
         – 1 cột (mobile <576px),
         – 2 cột (≥576px),
         – 3 cột (≥992px).
         Sử dụng row-cols-* và gutter (g-4).
    =========================================================== -->
    <div class="row row-cols-1 row-cols-sm-2 row-cols-lg-3 g-4">
        <!-- Nếu không có phòng nào -->
        <div th:if="${#lists.isEmpty(rooms)}" class="col-12">
            <div class="alert alert-warning text-center">
                No rooms found.
            </div>
        </div>

        <!-- Lặp từng room -->
        <div th:each="r : ${rooms}" class="col">
            <div class="room-card h-100">

                <!-- ******************************************************************************** -->
                <!-- Phần nội dung chính, khi click vào sẽ mở modal Detail -->
                <div
                        class="room-content"
                        data-bs-toggle="modal"
                        data-bs-target="#roomDetailModal"
                        th:attr="
                        data-id=${r.roomId},
                        data-number=${r.roomNumber},
                        data-name=${r.roomName},
                        data-type=${r.type},
                        data-capacity=${r.capacity},
                        data-status=${r.status},
                        data-dept=${r.departmentId},
                        data-notes=${r.notes}
                    "
                >
                    <div class="card-body d-flex flex-column">
                        <!-- Tên phòng & trạng thái -->
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <h5 class="card-title mb-0" th:text="${r.roomNumber} + ' – ' + ${r.roomName}">
                                R101 – Room A
                            </h5>
                            <span
                                    class="badge room-status"
                                    th:classappend="${r.status == 'Occupied'} ? ' bg-danger' : ' bg-success'"
                                    th:text="${r.status}"
                            >
                                Available
                            </span>
                        </div>

                        <!-- Thông tin chi tiết phòng (tóm tắt) -->
                        <div class="room-info mb-3">
                            <p class="mb-1">
                                <i class="bi bi-hdd-stack me-1"></i>
                                <strong>Type:</strong> <span th:text="${r.type}">Single</span>
                            </p>
                            <p class="mb-1">
                                <i class="bi bi-people-fill me-1"></i>
                                <strong>Capacity:</strong> <span th:text="${r.capacity}">1</span>
                            </p>
                            <p class="mb-0">
                                <i class="bi bi-building me-1"></i>
                                <strong>Dept ID:</strong> <span th:text="${r.departmentId}">2</span>
                            </p>
                        </div>
                    </div>
                </div>
                <!-- ******************************************************************************** -->

                <!-- Phần nút toggle status + Edit (không click vào Detail) -->
                <div class="card-body pt-0 d-flex flex-column">
                    <div class="button-container mt-auto d-flex">

                        <!-- Form toggle status: chặn luôn cả mousedown & click -->
                        <form
                                th:action="@{/admin/rooms/{id}/toggleStatus(id=${r.roomId},adminId=${adminId})}"
                                method="post"
                                style="flex: 1; margin-right: 0.5rem;"
                                onmousedown="event.stopPropagation()"
                                onclick="event.stopPropagation()"
                        >
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                            <button
                                    type="submit"
                                    class="btn w-100 btn-warning btn-action btn-sm"
                                    th:if="${r.status == 'Available'}"
                                    onmousedown="event.stopPropagation()"
                                    onclick="event.stopPropagation()"
                            >
                                Occupy
                            </button>
                            <button
                                    type="submit"
                                    class="btn w-100 btn-success btn-action btn-sm"
                                    th:if="${r.status == 'Occupied'}"
                                    onmousedown="event.stopPropagation()"
                                    onclick="event.stopPropagation()"
                            >
                                Make Available
                            </button>
                        </form>

                        <!-- Nút Edit: chặn luôn cả mousedown & click -->
                        <button
                                type="button"
                                class="btn btn-outline-secondary btn-action btn-sm"
                                data-bs-toggle="modal"
                                data-bs-target="#roomModal"
                                data-mode="edit"
                                th:attr="
                              data-id=${r.roomId},
                              data-number=${r.roomNumber},
                              data-name=${r.roomName},
                              data-type=${r.type},
                              data-capacity=${r.capacity},
                              data-status=${r.status},
                              data-dept=${r.departmentId},
                              data-notes=${r.notes}
                            "
                                onmousedown="event.stopPropagation()"
                                onclick="event.stopPropagation()"
                        >
                            <i class="bi bi-pencil-square"></i> Edit
                        </button>

                    </div>
                </div>
            </div>
        </div>
        <!-- end mỗi card -->
    </div>
    <!-- end row row-cols-1 row-cols-sm-2 row-cols-lg-3 g-4 -->
</div>
<!-- end container-fluid -->



<!-- ===================== Modal (Add/Edit Room) ===================== -->
<div
        class="modal fade"
        id="roomModal"
        tabindex="-1"
        aria-labelledby="roomModalLabel"
        aria-hidden="true"
>
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <!-- Tiêu đề sẽ đổi giữa “Add” hoặc “Edit” -->
                <h5 class="modal-title" id="roomModalLabel">Add/Edit Room</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body">
                <form
                        id="roomForm"
                        th:action="@{/admin/rooms/save(adminId=${adminId})}"
                        method="post"
                        enctype="multipart/form-data"
                >
                    <!-- CSRF token -->
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

                    <!-- Hidden field: roomId (nếu edit) -->
                    <input type="hidden" id="roomId" name="roomId" value="" />

                    <div class="container-fluid">
                        <div class="row g-3">
                            <!-- Room Number -->
                            <div class="col-md-6">
                                <label for="roomNumber" class="form-label">Room Number *</label>
                                <input
                                        type="text"
                                        class="form-control"
                                        id="roomNumber"
                                        name="roomNumber"
                                        placeholder="Enter room number"
                                        required
                                />
                            </div>
                            <!-- Room Name -->
                            <div class="col-md-6">
                                <label for="roomName" class="form-label">Room Name *</label>
                                <input
                                        type="text"
                                        class="form-control"
                                        id="roomName"
                                        name="roomName"
                                        placeholder="Enter room name"
                                        required
                                />
                            </div>
                            <!-- Type -->
                            <div class="col-md-4">
                                <label for="type" class="form-label">Type *</label>
                                <input
                                        type="text"
                                        class="form-control"
                                        id="type"
                                        name="type"
                                        placeholder="e.g. Single, Double"
                                        required
                                />
                            </div>
                            <!-- Capacity -->
                            <div class="col-md-4">
                                <label for="capacity" class="form-label">Capacity *</label>
                                <input
                                        type="number"
                                        class="form-control"
                                        id="capacity"
                                        name="capacity"
                                        min="1"
                                        placeholder="Enter capacity"
                                        required
                                />
                            </div>
                            <!-- Status -->
                            <div class="col-md-4">
                                <label for="status" class="form-label">Status *</label>
                                <select class="form-select" id="status" name="status" required>
                                    <option value="Available">Available</option>
                                    <option value="Occupied">Occupied</option>
                                </select>
                            </div>
                            <!-- Department ID -->
                            <div class="col-md-6">
                                <label for="departmentId" class="form-label">Department ID *</label>
                                <input
                                        type="number"
                                        class="form-control"
                                        id="departmentId"
                                        name="departmentId"
                                        min="1"
                                        placeholder="Enter department ID"
                                        required
                                />
                            </div>
                            <!-- Notes -->
                            <div class="col-md-6">
                                <label for="notes" class="form-label">Notes</label>
                                <textarea
                                        class="form-control"
                                        id="notes"
                                        name="notes"
                                        rows="2"
                                        placeholder="Enter any notes (optional)"
                                ></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="mt-4 text-end">
                        <button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">
                            Cancel
                        </button>
                        <button type="submit" class="btn btn-primary">Save</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<!-- =================== End Modal Add/Edit Room =================== -->


<!-- ===================== Modal (Room Detail) ===================== -->
<div
        class="modal fade"
        id="roomDetailModal"
        tabindex="-1"
        aria-labelledby="roomDetailModalLabel"
        aria-hidden="true"
>
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="roomDetailModalLabel">Room Detail</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Chỉ hiển thị thông tin (readonly) -->
                <form id="roomDetailForm">
                    <div class="container-fluid">
                        <div class="row g-3">
                            <!-- Room ID (readonly) -->
                            <div class="col-md-6">
                                <label for="detailRoomId" class="form-label">Room ID</label>
                                <input
                                        type="text"
                                        class="form-control"
                                        id="detailRoomId"
                                        name="detailRoomId"
                                        readonly
                                />
                            </div>
                            <!-- Room Number -->
                            <div class="col-md-6">
                                <label for="detailRoomNumber" class="form-label">Room Number</label>
                                <input
                                        type="text"
                                        class="form-control"
                                        id="detailRoomNumber"
                                        name="detailRoomNumber"
                                        readonly
                                />
                            </div>
                            <!-- Room Name -->
                            <div class="col-md-6">
                                <label for="detailRoomName" class="form-label">Room Name</label>
                                <input
                                        type="text"
                                        class="form-control"
                                        id="detailRoomName"
                                        name="detailRoomName"
                                        readonly
                                />
                            </div>
                            <!-- Type -->
                            <div class="col-md-6">
                                <label for="detailType" class="form-label">Type</label>
                                <input
                                        type="text"
                                        class="form-control"
                                        id="detailType"
                                        name="detailType"
                                        readonly
                                />
                            </div>
                            <!-- Capacity -->
                            <div class="col-md-4">
                                <label for="detailCapacity" class="form-label">Capacity</label>
                                <input
                                        type="number"
                                        class="form-control"
                                        id="detailCapacity"
                                        name="detailCapacity"
                                        readonly
                                />
                            </div>
                            <!-- Status -->
                            <div class="col-md-4">
                                <label for="detailStatus" class="form-label">Status</label>
                                <input
                                        type="text"
                                        class="form-control"
                                        id="detailStatus"
                                        name="detailStatus"
                                        readonly
                                />
                            </div>
                            <!-- Department ID -->
                            <div class="col-md-4">
                                <label for="detailDeptId" class="form-label">Department ID</label>
                                <input
                                        type="number"
                                        class="form-control"
                                        id="detailDeptId"
                                        name="detailDeptId"
                                        readonly
                                />
                            </div>
                            <!-- Notes -->
                            <div class="col-12">
                                <label for="detailNotes" class="form-label">Notes</label>
                                <textarea
                                        class="form-control"
                                        id="detailNotes"
                                        name="detailNotes"
                                        rows="3"
                                        readonly
                                ></textarea>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    Close
                </button>
            </div>
        </div>
    </div>
</div>
<!-- =================== End Modal Room Detail =================== -->


<!-- Bootstrap JS Bundle (bao gồm Popper) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // Khi modal “Add/Edit Room” show → prefill form Edit
    var roomModalEl = document.getElementById('roomModal');
    roomModalEl.addEventListener('show.bs.modal', function (event) {
        var button = event.relatedTarget;       // nút “Add” hoặc “Edit”
        var mode = button.getAttribute('data-mode'); // "add" hoặc "edit"
        var modalTitle = roomModalEl.querySelector('.modal-title');
        var form = document.getElementById('roomForm');

        // Các input trong form
        var inputId       = form.querySelector('#roomId');
        var inputNumber   = form.querySelector('#roomNumber');
        var inputName     = form.querySelector('#roomName');
        var inputType     = form.querySelector('#type');
        var inputCapacity = form.querySelector('#capacity');
        var selectStatus  = form.querySelector('#status');
        var inputDeptId   = form.querySelector('#departmentId');
        var inputNotes    = form.querySelector('#notes');

        if (mode === 'add') {
            modalTitle.textContent = 'Add New Room';
            inputId.value       = '';
            inputNumber.value   = '';
            inputName.value     = '';
            inputType.value     = '';
            inputCapacity.value = '';
            selectStatus.value  = 'Available';
            inputDeptId.value   = '';
            inputNotes.value    = '';
        } else if (mode === 'edit') {
            modalTitle.textContent = 'Edit Room';
            inputId.value       = button.getAttribute('data-id');
            inputNumber.value   = button.getAttribute('data-number');
            inputName.value     = button.getAttribute('data-name');
            inputType.value     = button.getAttribute('data-type');
            inputCapacity.value = button.getAttribute('data-capacity');
            selectStatus.value  = button.getAttribute('data-status');
            inputDeptId.value   = button.getAttribute('data-dept');
            inputNotes.value    = button.getAttribute('data-notes') || '';
        }
    });

    // Khi modal “Room Detail” show → fill data vào các input readonly
    var roomDetailModalEl = document.getElementById('roomDetailModal');
    roomDetailModalEl.addEventListener('show.bs.modal', function (event) {
        var button = event.relatedTarget;      // chính là .room-content (vùng click để xem detail)
        // Lấy thông tin từ data-* attributes
        var roomId     = button.getAttribute('data-id');
        var roomNumber = button.getAttribute('data-number');
        var roomName   = button.getAttribute('data-name');
        var type       = button.getAttribute('data-type');
        var capacity   = button.getAttribute('data-capacity');
        var status     = button.getAttribute('data-status');
        var deptId     = button.getAttribute('data-dept');
        var notes      = button.getAttribute('data-notes');

        // Điền vào các input/textarea trong modal detail (readonly)
        document.getElementById('detailRoomId').value       = roomId;
        document.getElementById('detailRoomNumber').value   = roomNumber;
        document.getElementById('detailRoomName').value     = roomName;
        document.getElementById('detailType').value         = type;
        document.getElementById('detailCapacity').value     = capacity;
        document.getElementById('detailStatus').value       = status;
        document.getElementById('detailDeptId').value       = deptId;
        document.getElementById('detailNotes').value        = notes || '';
    });
</script>
</body>
</html>
