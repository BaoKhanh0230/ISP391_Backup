<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New Appointment</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            color: #212529;
        }

        .container {
            padding: 2rem;
        }

        .card {
            border-top: 4px solid #0d6efd;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            max-width: 900px;
            margin: 0 auto;
        }

        .card-body {
            padding: 2rem;
        }

        h1 {
            font-size: 1.75rem;
            font-weight: 700;
            color: #212529;
            text-align: center;
            margin-bottom: 1.5rem;
        }

        h2 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #212529;
            margin-bottom: 1.5rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            font-size: 0.875rem;
            font-weight: 500;
            color: #495057;
        }

        .form-control, .form-select {
            border-radius: 0.375rem;
            font-size: 0.9rem;
            padding: 0.75rem;
        }

        .form-control:focus, .form-select:focus {
            border-color: #0d6efd;
            box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
        }

        .invalid-feedback {
            color: #dc3545;
            font-size: 0.75rem;
            display: none;
        }

        .is-invalid .invalid-feedback {
            display: block;
        }

        .is-invalid {
            border-color: #dc3545 !important;
        }

        .is-valid {
            border-color: #28a745 !important;
        }

        .btn-primary {
            background-color: #0d6efd;
            border-color: #0d6efd;
            padding: 0.75rem 2rem;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .btn-primary:hover {
            background-color: #0b5ed7;
            border-color: #0a58ca;
        }

        .btn-secondary {
            background-color: #6c757d;
            border-color: #6c757d;
            padding: 0.75rem 2rem;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .btn-secondary:hover {
            background-color: #5c636a;
            border-color: #565e64;
        }

        .alert {
            margin-bottom: 1.5rem;
            font-size: 0.9rem;
        }

        @media (max-width: 767.98px) {
            .card-body {
                padding: 1.5rem;
            }

            h1 {
                font-size: 1.5rem;
            }

            h2 {
                font-size: 1rem;
            }

            .btn-primary, .btn {
                padding: 0.5rem 1.5rem;
                font-size: 0.85rem;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <h1>New Appointment Registration</h1>
    <form id="appointmentForm" class="card">
        <div class="card-body">
            <!-- Success/Error Messages -->
            <div id="successMessage" class="alert alert-success d-none" role="alert"></div>
            <div id="errorMessage" class="alert alert-danger d-none" role="alert"></div>

            <!-- Personal Information -->
            <div class="mb-4">
                <h2>1. Personal Information</h2>
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="fullName" class="form-label">Full Name*</label>
                            <input type="text" class="form-control" id="fullName" name="fullName" required placeholder="John Doe">
                            <div id="fullNameError" class="invalid-feedback">Full Name is required.</div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="gender" class="form-label">Gender*</label>
                            <select class="form-select" id="gender" name="gender" required>
                                <option value="">Select Gender</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                                <option value="Other">Other</option>
                            </select>
                            <div class="invalid-feedback">Gender is required.</div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="dateOfBirth" class="form-label">Date of Birth*</label>
                            <input type="date" class="form-control" id="dateOfBirth" name="dateOfBirth" required max="2025-06-05">
                            <div id="dateOfBirthError" class="invalid-feedback">Date of Birth cannot be in the future.</div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="citizenId" class="form-label">Citizen Identification Card*</label>
                            <input type="text" class="form-control" id="citizenId" name="citizenId" required pattern="\d{12}" placeholder="030303000999">
                            <div id="citizenIdError" class="invalid-feedback">Citizen ID must be exactly 12 digits.</div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="healthInsuranceNumber" class="form-label">Health Insurance Number</label>
                            <input type="text" class="form-control" id="healthInsuranceNumber" name="healthInsuranceNumber" placeholder="AA4303028889999">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="phoneNumber" class="form-label">Phone Number*</label>
                            <input type="tel" class="form-control" id="phoneNumber" name="phoneNumber" required pattern="\d{10}" placeholder="0901234567">
                            <div id="phoneNumberError" class="invalid-feedback">Phone Number must be exactly 10 digits.</div>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="form-group">
                            <label for="contactAddress" class="form-label">Contact Address</label>
                            <input type="text" class="form-control" id="contactAddress" name="contactAddress" placeholder="123 Lang Street, Dong Da, Hanoi">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="email" class="form-label">Email</label>
                            <input type="email" class="form-control" id="email" name="email" pattern=".*@gmail\.com" placeholder="example@gmail.com">
                            <div id="emailError" class="invalid-feedback">Email must end with @gmail.com (e.g., example@gmail.com).</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Appointment Information -->
            <div class="mb-4">
                <h2>2. Appointment Information</h2>
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="department" class="form-label">Department/Clinic*</label>
                            <select class="form-select" id="department" name="department" required>
                                <option value="">Select Department</option>
                                <option value="General Internal Medicine">General Internal Medicine</option>
                                <option value="Surgery">Surgery</option>
                                <option value="Obstetrics">Obstetrics</option>
                                <option value="ENT">ENT</option>
                                <option value="Pediatrics">Pediatrics</option>
                                <option value="Dermatology">Dermatology</option>
                            </select>
                            <div class="invalid-feedback">Department is required.</div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="typeOfVisit" class="form-label">Type of Visit*</label>
                            <select class="form-select" id="typeOfVisit" name="typeOfVisit" required>
                                <option value="">Select Type</option>
                                <option value="Regular Visit">Regular Visit</option>
                                <option value="On-Demand Visit">On-Demand Visit</option>
                                <option value="Follow-Up Visit">Follow-Up Visit</option>
                            </select>
                            <div class="invalid-feedback">Type of Visit is required.</div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="preferredDateTime" class="form-label">Preferred Date and Time*</label>
                            <input type="datetime-local" class="form-control" id="preferredDateTime" name="preferredDateTime" required min="2025-06-05T05:08" max="2025-07-05T23:59">
                            <div id="preferredDateTimeError" class="invalid-feedback">Preferred Date and Time must be between now and 30 days in the future.</div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="preferredDoctor" class="form-label">Preferred Doctor</label>
                            <input type="text" class="form-control" id="preferredDoctor" name="preferredDoctor" placeholder="Dr. John Smith">
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="form-group">
                            <label for="reasonForVisit" class="form-label">Reason for Visit*</label>
                            <textarea class="form-control" id="reasonForVisit" name="reasonForVisit" required rows="4" placeholder="Headache, fever, persistent cough..."></textarea>
                            <div id="reasonForVisitError" class="invalid-feedback">Reason for Visit cannot exceed 100 words.</div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="referralLetter" class="form-label">Referral Letter?</label>
                            <input type="text" class="form-control" id="referralLetter" name="referralLetter" placeholder="Referring Facility Name">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="lastVisitDate" class="form-label">Last Visit Date (if Follow-Up)</label>
                            <input type="date" class="form-control" id="lastVisitDate" name="lastVisitDate">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Representative Information -->
            <div class="mb-4">
                <h2>3. Representative Information (if applicable)</h2>
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="representativeFullName" class="form-label">Representative Full Name</label>
                            <input type="text" class="form-control" id="representativeFullName" name="representativeFullName" placeholder="Jane Doe">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="relationshipToPatient" class="form-label">Relationship to Patient</label>
                            <input type="text" class="form-control" id="relationshipToPatient" name="relationshipToPatient" placeholder="Spouse, Parent...">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="representativePhoneNumber" class="form-label">Representative Phone Number</label>
                            <input type="tel" class="form-control" id="representativePhoneNumber" name="representativePhoneNumber" pattern="\d{10}" placeholder="0901234567">
                            <div id="representativePhoneNumberError" class="invalid-feedback">Phone Number must be exactly 10 digits.</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Special Notes -->
            <div class="mb-4">
                <h2>4. Special Notes</h2>
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="specialAssistance" class="form-label">Special Assistance Requirements</label>
                            <input type="text" class="form-control" id="specialAssistance" name="specialAssistance" placeholder="Wheelchair, disability support...">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="languageSupport" class="form-label">Language Support</label>
                            <input type="text" class="form-control" id="languageSupport" name="languageSupport" placeholder="English, Japanese...">
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="form-group">
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="vatInvoiceRequired" name="vatInvoiceRequired">
                                <label for="vatInvoiceRequired" class="form-check-label">VAT Invoice Required</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Buttons -->
            <div class="text-center">
                <button type="button" onclick="window.history.back()" class="btn btn-secondary me-3">
                    <i class="fas fa-arrow-left me-2"></i>Back
                </button>
                <button type="submit" class="btn btn-primary">Register Appointment</button>
            </div>
        </div>
    </form>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Real-time validation functions
    function validateCitizenId() {
        const input = document.getElementById('citizenId');
        const error = document.getElementById('citizenIdError');
        const value = input.value.trim();
        const isValid = /^\d{12}$/.test(value);

        if (value === '') {
            input.classList.remove('is-invalid', 'is-valid');
            error.style.display = 'none';
        } else if (isValid) {
            input.classList.remove('is-invalid');
            input.classList.add('is-valid');
            error.style.display = 'none';
        } else {
            input.classList.remove('is-valid');
            input.classList.add('is-invalid');
            error.style.display = 'block';
        }
        return isValid || value === '';
    }

    function validatePhoneNumber() {
        const input = document.getElementById('phoneNumber');
        const error = document.getElementById('phoneNumberError');
        const value = input.value.trim();
        const isValid = /^\d{10}$/.test(value);

        if (value === '') {
            input.classList.remove('is-invalid', 'is-valid');
            error.style.display = 'none';
        } else if (isValid) {
            input.classList.remove('is-invalid');
            input.classList.add('is-valid');
            error.style.display = 'none';
        } else {
            input.classList.remove('is-valid');
            input.classList.add('is-invalid');
            error.style.display = 'block';
        }
        return isValid || value === '';
    }

    function validateEmail() {
        const input = document.getElementById('email');
        const error = document.getElementById('emailError');
        const value = input.value.trim();
        const isValid = value === '' || /^[^\s@]+@gmail\.com$/.test(value);

        if (value === '') {
            input.classList.remove('is-invalid', 'is-valid');
            error.style.display = 'none';
        } else if (isValid) {
            input.classList.remove('is-invalid');
            input.classList.add('is-valid');
            error.style.display = 'none';
        } else {
            input.classList.remove('is-valid');
            input.classList.add('is-invalid');
            error.style.display = 'block';
        }
        return isValid;
    }

    function validateRepresentativePhoneNumber() {
        const input = document.getElementById('representativePhoneNumber');
        const error = document.getElementById('representativePhoneNumberError');
        const value = input.value.trim();
        const isValid = /^\d{10}$/.test(value) || value === '';

        if (value === '') {
            input.classList.remove('is-invalid', 'is-valid');
            error.style.display = 'none';
        } else if (isValid) {
            input.classList.remove('is-invalid');
            input.classList.add('is-valid');
            error.style.display = 'none';
        } else {
            input.classList.remove('is-valid');
            input.classList.add('is-invalid');
            error.style.display = 'block';
        }
        return isValid;
    }

    // Attach real-time validation listeners
    document.getElementById('citizenId').addEventListener('input', validateCitizenId);
    document.getElementById('phoneNumber').addEventListener('input', validatePhoneNumber);
    document.getElementById('email').addEventListener('input', validateEmail);
    document.getElementById('representativePhoneNumber').addEventListener('input', validateRepresentativePhoneNumber);

    // Form submission validation
    document.getElementById('appointmentForm').addEventListener('submit', function(e) {
        e.preventDefault();

        // Get form fields
        const fullName = document.getElementById('fullName').value.trim();
        const gender = document.getElementById('gender').value;
        const dateOfBirth = document.getElementById('dateOfBirth').value;
        const citizenId = document.getElementById('citizenId').value.trim();
        const phoneNumber = document.getElementById('phoneNumber').value.trim();
        const email = document.getElementById('email').value.trim();
        const department = document.getElementById('department').value;
        const typeOfVisit = document.getElementById('typeOfVisit').value;
        const preferredDateTime = document.getElementById('preferredDateTime').value;
        const reasonForVisit = document.getElementById('reasonForVisit').value.trim();

        // Reset error messages
        document.getElementById('fullNameError').style.display = 'none';
        document.getElementById('citizenIdError').style.display = 'none';
        document.getElementById('phoneNumberError').style.display = 'none';
        document.getElementById('emailError').style.display = 'none';
        document.getElementById('reasonForVisitError').style.display = 'none';
        document.getElementById('dateOfBirthError').style.display = 'none';
        document.getElementById('preferredDateTimeError').style.display = 'none';
        document.getElementById('successMessage').classList.add('d-none');
        document.getElementById('errorMessage').classList.add('d-none');

        let isValid = true;

        // Validate Full Name
        if (!fullName) {
            document.getElementById('fullName').classList.add('is-invalid');
            document.getElementById('fullNameError').style.display = 'block';
            isValid = false;
        } else {
            document.getElementById('fullName').classList.remove('is-invalid');
            document.getElementById('fullName').classList.add('is-valid');
        }

        // Validate Gender
        if (!gender) {
            document.getElementById('gender').classList.add('is-invalid');
            isValid = false;
        } else {
            document.getElementById('gender').classList.remove('is-invalid');
            document.getElementById('gender').classList.add('is-valid');
        }

        // Validate Date of Birth
        const today = new Date('2025-06-05');
        const dob = new Date(dateOfBirth);
        if (!dateOfBirth || dob > today) {
            document.getElementById('dateOfBirth').classList.add('is-invalid');
            document.getElementById('dateOfBirthError').style.display = 'block';
            isValid = false;
        } else {
            document.getElementById('dateOfBirth').classList.remove('is-invalid');
            document.getElementById('dateOfBirth').classList.add('is-valid');
        }

        // Validate Citizen Identification Card
        if (!validateCitizenId()) {
            isValid = false;
        }

        // Validate Phone Number
        if (!validatePhoneNumber()) {
            isValid = false;
        }

        // Validate Email
        if (!validateEmail()) {
            isValid = false;
        }

        // Validate Department
        if (!department) {
            document.getElementById('department').classList.add('is-invalid');
            isValid = false;
        } else {
            document.getElementById('department').classList.remove('is-invalid');
            document.getElementById('department').classList.add('is-valid');
        }

        // Validate Type of Visit
        if (!typeOfVisit) {
            document.getElementById('typeOfVisit').classList.add('is-invalid');
            isValid = false;
        } else {
            document.getElementById('typeOfVisit').classList.remove('is-invalid');
            document.getElementById('typeOfVisit').classList.add('is-valid');
        }

        // Validate Preferred Date and Time
        const now = new Date('2025-06-05T05:08:00+07:00');
        const oneMonthLater = new Date(now);
        oneMonthLater.setDate(now.getDate() + 30);
        const preferred = new Date(preferredDateTime);
        if (!preferredDateTime || preferred < now || preferred > oneMonthLater) {
            document.getElementById('preferredDateTime').classList.add('is-invalid');
            document.getElementById('preferredDateTimeError').style.display = 'block';
            isValid = false;
        } else {
            document.getElementById('preferredDateTime').classList.remove('is-invalid');
            document.getElementById('preferredDateTime').classList.add('is-valid');
        }

        // Validate Reason for Visit
        const wordCount = reasonForVisit.split(/\s+/).filter(word => word.length > 0).length;
        if (!reasonForVisit || wordCount > 100) {
            document.getElementById('reasonForVisit').classList.add('is-invalid');
            document.getElementById('reasonForVisitError').style.display = 'block';
            isValid = false;
        } else {
            document.getElementById('reasonForVisit').classList.remove('is-invalid');
            document.getElementById('reasonForVisit').classList.add('is-valid');
        }

        // Validate Representative Phone Number
        if (!validateRepresentativePhoneNumber()) {
            isValid = false;
        }

        // If all validations pass, submit the form
        if (isValid) {
            // Simulate API call
            // fetch('/api/appointments', {
            //   method: 'POST',
            //   body: new FormData(this)
            // }).then(response => {
            //   if (response.ok) {
            //     document.getElementById('successMessage').textContent = 'Appointment registered successfully!';
            //     document.getElementById('successMessage').classList.remove('d-none');
            //     this.reset();
            //     document.querySelectorAll('.form-control, .form-select').forEach(el => el.classList.remove('is-valid', 'is-invalid'));
            //   } else {
            //     throw new Error('Failed to register appointment');
            //   }
            // }).catch(error => {
            //   document.getElementById('errorMessage').textContent = 'Error registering appointment. Please try again.';
            //   document.getElementById('errorMessage').classList.remove('d-none');
            // });

            // Mock success response
            document.getElementById('successMessage').textContent = 'Appointment registered successfully!';
            document.getElementById('successMessage').classList.remove('d-none');
            document.getElementById('appointmentForm').reset();
            document.querySelectorAll('.form-control, .form-select').forEach(el => el.classList.remove('is-valid', 'is-invalid'));
            setTimeout(() => {
                document.getElementById('successMessage').classList.add('d-none');
            }, 3000);
        } else {
            document.getElementById('errorMessage').textContent = 'Please correct the errors in the form.';
            document.getElementById('errorMessage').classList.remove('d-none');
        }
    });
</script>
</body>
</html>